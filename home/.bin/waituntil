#!/bin/bash

# The script takes a single argument, which is the time to wait until. It then calculates the number of seconds to sleep until that time and sleeps for that amount of time.
# Usage: waituntil <time>

if [ $# -ne 1 ]; then
    echo "Usage: waituntil <time>"
    exit 1
fi

# Get the current time
now=$(date +%s)

# Get the time to wait until
future=$(date -d "$1" +%s)

# Calculate the time to sleep
sleep_time=$((future - now))

# If sleep time is negative, it means the time has already passed, and we should wait until the next day
sleep_time=$((sleep_time < 0 ? sleep_time + 86400 : sleep_time))

# Sleep until the specified time
# Print status message that updates every second, rewriting the same line
while [ $sleep_time -gt 0 ]; do
    echo -en "\rSleeping for $sleep_time seconds until $1, time is now $(date +%H:%M:%S)"
    sleep 1
    sleep_time=$((sleep_time - 1))
done
echo "Time is now $(date +%H:%M:%S)"
